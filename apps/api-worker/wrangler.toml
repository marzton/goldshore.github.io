name = "goldshore-api"
main = "src/index.ts"
compatibility_date = "2024-11-20"
workers_dev = false
minify = true

[[kv_namespaces]]
binding = "KV_SESSIONS"
id = "dev-kv-sessions"
preview_id = "dev-kv-sessions"

[[kv_namespaces]]
binding = "KV_CACHE"
id = "dev-kv-cache"
preview_id = "dev-kv-cache"

[[durable_objects.bindings]]
name = "DO_SESSIONS"
class_name = "SessionDO"

[[queues.producers]]
binding = "Q_EVENTS"
queue = "goldshore-events"

[[queues.consumers]]
queue = "goldshore-events"
max_batch_size = 50
max_wait_ms = 2000
dead_letter_queue = "goldshore-dlq"

[observability]
enabled = true

[triggers]
crons = ["*/30 * * * *"]

[[routes]]
pattern = "api.goldshore.org/*"
zone_name = "goldshore.org"

[vars]
GOLDSHORE_ENV = "production"
GOLDSHORE_ORIGIN = "https://goldshore.org"
GOLDSHORE_CORS = "https://goldshore.org,https://www.goldshore.org,https://admin.goldshore.org,https://preview.goldshore.org,http://localhost:5173,http://127.0.0.1:5173"
JWT_AUDIENCE = "goldshore-api"
JWT_ISSUER = "https://auth.goldshore.org"
RATE_LIMIT_MAX = "120"
RATE_LIMIT_WINDOW = "60"

[env.preview.vars]
GOLDSHORE_ENV = "preview"
GOLDSHORE_ORIGIN = "https://preview.goldshore.org"
GOLDSHORE_CORS = "https://preview.goldshore.org"
JWT_AUDIENCE = "goldshore-api-preview"
JWT_ISSUER = "https://auth-preview.goldshore.org"

[env.development.vars]
GOLDSHORE_ENV = "development"
GOLDSHORE_ORIGIN = "http://localhost:8787"
GOLDSHORE_CORS = "http://localhost:8787,http://localhost:3000"
JWT_AUDIENCE = "goldshore-api-dev"
JWT_ISSUER = "https://auth-dev.goldshore.org"

[env.production]
[[env.production.kv_namespaces]]
binding = "KV_SESSIONS"
id = "${KV_SESSIONS_PROD}"
preview_id = "${KV_SESSIONS_PREVIEW}"

[[env.production.kv_namespaces]]
binding = "KV_CACHE"
id = "${KV_CACHE_PROD}"
preview_id = "${KV_CACHE_PROD}"

[env.production.vars]
GOLDSHORE_ENV = "production"
GOLDSHORE_ORIGIN = "https://goldshore.org"
GOLDSHORE_CORS = "https://goldshore.org,https://www.goldshore.org,https://admin.goldshore.org,https://preview.goldshore.org"
JWT_AUDIENCE = "goldshore-api"
JWT_ISSUER = "https://auth.goldshore.org"
RATE_LIMIT_MAX = "120"
RATE_LIMIT_WINDOW = "60"

[env.preview]
[[env.preview.kv_namespaces]]
binding = "KV_SESSIONS"
id = "${KV_SESSIONS_PREVIEW}"
preview_id = "${KV_SESSIONS_PREVIEW}"

[env.development]
[[env.development.kv_namespaces]]
binding = "KV_SESSIONS"
id = "${KV_SESSIONS_DEV}"
preview_id = "${KV_SESSIONS_DEV}"
