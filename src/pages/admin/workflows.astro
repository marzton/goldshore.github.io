---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdminLayout from '../../components/admin/AdminLayout.astro';
import { buildApiUrl } from '../../lib/api';

const workflows = [
  {
    name: 'End-of-day settlement',
    description: 'Push intraday fills into the settlement queue and notify operations.',
    endpoint: buildApiUrl('/admin/workflow/settlement')
  },
  {
    name: 'Risk recalibration',
    description: 'Recompute risk limits and propagate guardrails to the execution fabric.',
    endpoint: buildApiUrl('/admin/workflow/risk-refresh')
  },
  {
    name: 'Customer onboarding sync',
    description: 'Sync CRM records, D1 entries, and Access seats for new customers.',
    endpoint: buildApiUrl('/admin/workflow/onboarding')
  }
];
---
<BaseLayout title="Admin | Workflows" description="Trigger operational and compliance workflows on demand.">
  <AdminLayout heading="Workflows" description="Enqueue jobs across queues and workers in a single click.">
    <div class="grid gap-6 md:grid-cols-2">
      {workflows.map((workflow) => (
        <div class="flex flex-col rounded-xl border border-border/60 bg-bg p-6 shadow-elev-1">
          <div class="space-y-2">
            <h2 class="font-display text-xl text-text">{workflow.name}</h2>
            <p class="text-sm text-muted">{workflow.description}</p>
          </div>
          <button
            class="mt-6 inline-flex items-center justify-center rounded-lg bg-[var(--brand)] px-4 py-2 text-sm font-medium text-[var(--brand-contrast)] shadow-elev-1 transition hover:brightness-105 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/40"
            data-endpoint={workflow.endpoint}
            data-method="POST"
            data-include-credentials
          >
            Trigger workflow
          </button>
        </div>
      ))}
    </div>
  </AdminLayout>
</BaseLayout>
