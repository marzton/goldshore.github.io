# wrangler.toml (Worker router)
name = "router"
main = "src/router.js"
compatibility_date = "2024-06-30"
workers_dev = false
account_id = "f77de112d2019e5456a3198a8bb50bd2"

[vars]
PRODUCTION_ASSETS = "https://goldshore-org.pages.dev"
PREVIEW_ASSETS = "https://goldshore-org-preview.pages.dev"
DEV_ASSETS = "https://goldshore-org-dev.pages.dev"
GPT_ALLOWED_ORIGINS = "https://goldshore.org,https://www.goldshore.org,https://preview.goldshore.org,https://dev.goldshore.org"

# Secrets such as FORMSPREE_ENDPOINT and TURNSTILE_SECRET are provided via
# `wrangler secret put â€¦` or `.dev.vars` in local development.

[env.production]
# Cloudflare resolves Worker routes by ascending priority (lower numbers match first)
# and then by declaration order. Assign explicit priorities so preview/dev hostnames
# keep routing to their environment-specific workers even when production hosts cover
# the apex domain. Avoid wildcards so API subdomains remain mapped to their dedicated
# infrastructure rather than being intercepted by this router.
[[env.production.routes]]
pattern = "preview.goldshore.org/*"
zone_name = "goldshore.org"
script = "router-preview"
priority = 10

[[env.production.routes]]
pattern = "dev.goldshore.org/*"
zone_name = "goldshore.org"
script = "router-dev"
priority = 10

[[env.production.routes]]
pattern = "preview.gearswipe.com/*"
zone_name = "gearswipe.com"
script = "router-preview"
priority = 10

[[env.production.routes]]
pattern = "dev.gearswipe.com/*"
zone_name = "gearswipe.com"
script = "router-dev"
priority = 10

[[env.production.routes]]
pattern = "preview.armsway.com/*"
zone_name = "armsway.com"
script = "router-preview"
priority = 10

[[env.production.routes]]
pattern = "dev.armsway.com/*"
zone_name = "armsway.com"
script = "router-dev"
priority = 10

[[env.production.routes]]
pattern = "preview.banproof.com/*"
zone_name = "banproof.com"
script = "router-preview"
priority = 10

[[env.production.routes]]
pattern = "dev.banproof.com/*"
zone_name = "banproof.com"
script = "router-dev"
priority = 10

[[env.production.routes]]
pattern = "goldshore.org/*"
zone_name = "goldshore.org"
priority = 50

[[env.production.routes]]
pattern = "www.goldshore.org/*"
zone_name = "goldshore.org"
priority = 50

[[env.production.routes]]
pattern = "gearswipe.com/*"
zone_name = "gearswipe.com"
priority = 50

[[env.production.routes]]
pattern = "www.gearswipe.com/*"
zone_name = "gearswipe.com"
priority = 50

[[env.production.routes]]
pattern = "armsway.com/*"
zone_name = "armsway.com"
priority = 50

[[env.production.routes]]
pattern = "www.armsway.com/*"
zone_name = "armsway.com"
priority = 50

[[env.production.routes]]
pattern = "banproof.com/*"
zone_name = "banproof.com"
priority = 50

[[env.production.routes]]
pattern = "www.banproof.com/*"
zone_name = "banproof.com"
priority = 50

[env.production.vars]
ASSETS_ORIGIN = "https://goldshore-org.pages.dev"

[env.preview]
# Mirror any marketing hostnames added above so preview deployments have
# explicit routes for their `preview.<domain>` hostnames. Avoid wildcard
# routes here as well to keep service-specific subdomains pointed at their
# dedicated infrastructure.
routes = [
  { pattern = "preview.goldshore.org/*", zone_name = "goldshore.org" },
  { pattern = "preview.gearswipe.com/*", zone_name = "gearswipe.com" },
  { pattern = "preview.armsway.com/*", zone_name = "armsway.com" },
  { pattern = "preview.banproof.com/*", zone_name = "banproof.com" }
]

[env.preview.vars]
ASSETS_ORIGIN = "https://goldshore-org-preview.pages.dev"

[env.dev]
# Development routes should receive the matching `dev.<domain>` hostnames
# for any marketing site onboarded above. Continue to avoid wildcard
# patterns so environment-specific services stay mapped to their own
# infrastructure.
routes = [
  { pattern = "dev.goldshore.org/*", zone_name = "goldshore.org" },
  { pattern = "dev.gearswipe.com/*", zone_name = "gearswipe.com" },
  { pattern = "dev.armsway.com/*", zone_name = "armsway.com" },
  { pattern = "dev.banproof.com/*", zone_name = "banproof.com" }
]

[env.dev.vars]
ASSETS_ORIGIN = "https://goldshore-org-dev.pages.dev"

[[analytics_engine_datasets]]
binding = "GOLD_ANALYTICS"
dataset = "goldshore-events"
# D1 database bindings are temporarily omitted (Path B) until the
# goldshore-db instance is provisioned with a real UUID.
